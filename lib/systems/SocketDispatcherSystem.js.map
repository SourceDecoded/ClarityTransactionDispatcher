{"version":3,"sources":["../../src/systems/SocketDispatcherSystem.js"],"names":["SocketDispatcherSystem","config","_name","_guid","Error","socket","socketStream","_socketStream","_socket","_socketStreamInstance","methodName","on","data","id","Array","isArray","arguments","_clarityTransactionDispatcher","apply","then","response","_respond","catch","error","_respondByError","_buildMethodAsync","_buildMethod","emit","message","clarityTransactionDispatcher","component","entity","oldEntity","newEntity","oldContentId","newContentId","oldComponent","newComponent","name","service"],"mappings":"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","file":"SocketDispatcherSystem.js","sourcesContent":["export default class SocketDispatcherSystem {\n    constructor(config) {\n        this._name = \"RemoteDispatcherSystem\";\n        this._guid = \"b42ea3d4-1ef6-4f00-8630-298366160df8\";\n\n        if (config == null) {\n            throw new Error(\"Needs to provide a socket and a socket stream.\");\n        }\n\n        if (config.socket == null) {\n            throw new Error(\"Needs to provide a socket to pipe to.\");\n        }\n\n        if (config.socketStream == null) {\n            throw new Error(\"Needs to provide a socket stream.\");\n        }\n\n        this._socketStream = config.socketStream;\n        this._socket = config.socket;\n        this._socketStreamInstance = this._socketStream(this._socket);\n    }\n\n     _buildMethodAsync(methodName) {\n        this._socket.on(methodName, (data) => {\n            if (data.id != null && Array.isArray(data.arguments)) {\n                this._clarityTransactionDispatcher[methodName].apply(this._clarityTransactionDispatcher, arguments).then((response) => {\n                    this._respond(data.id, response);\n                }).catch((error) => {\n                    this._respondByError(data.id, error);\n                });\n            }\n        });\n    }\n\n    _buildMethod(methodName) {\n        this._socket.on(methodName, (data) => {\n            if (data.id != null && Array.isArray(data.arguments)) {\n                try {\n                    this._respond(data.id, this._clarityTransactionDispatcher[methodName].apply(this._clarityTransactionDispatcher, arguments));\n                } catch (error) {\n                    this._respondByError(data.id, error);\n                }\n            }\n        });\n    }\n\n    _buildReturnStreamMethodAsync(methodName) {\n        this._socket.on(methodName, (data) => {\n            if (data.id != null && Array.isArray(data.arguments)) {\n                this._clarityTransactionDispatcher[methodName].apply(this._clarityTransactionDispatcher, arguments).then((response) => {\n                    this._respond(data.id, response);\n                }).catch((error) => {\n                    this._respondByError(data.id, error);\n                });\n            }\n        });\n    }\n\n     _buildSocketInterface() {\n        this._buildMethodAsync(\"addComponentAsync\");\n        this._buildMethodAsync(\"addEntityAsync\");\n        this._buildMethodAsync(\"approveComponentRemovalAsync\");\n        this._buildMethodAsync(\"approveEntityRemovalAsync\");\n        this._buildMethodAsync(\"getComponentByIdAsync\");\n        this._buildMethodAsync(\"getComponentsByEntityAndTypeAsync\");\n        this._buildMethodAsync(\"getComponentsByEntityAsync\");\n        this._buildMethodAsync(\"getEntityByIdAsync\");\n        this._buildMethodAsync(\"getEntities\");\n        this._buildMethodAsync(\"getEntityByIdAsync\");\n        this._buildMethodAsync(\"getEntityContentStreamByContentIdAsync\");\n        this._buildMethodAsync(\"getEntityContentStreamByEntityAsync\");\n        this._buildMethod(\"logError\");\n        this._buildMethod(\"logMessage\");\n        this._buildMethod(\"logWarning\");\n        this._buildMethodAsync(\"removeComponentAsync\");\n        this._buildMethodAsync(\"removeEntityAsync\");\n        this._buildMethodAsync(\"removeEntityContentAsync\");\n        this._buildMethodAsync(\"updateComponentAsync\");\n        this._buildMethodAsync(\"updateEntityAsync\");\n        this._buildMethodAsync(\"validateComponentAsync\");\n        this._buildMethodAsync(\"validateEntityAsync\");\n        this._buildMethodAsync(\"validateEntityContentAsync\");\n    }\n\n     _respond(id, response) {\n        this._socket.emit(\"response\", {\n            id: id,\n            response: response,\n            error: null\n        });\n    }\n\n     _respondByError(id, error) {\n        this._socket.emit(\"response\", {\n            id: id,\n            response: null,\n            error: {\n                message: error.message\n            }\n        });\n    }\n\n    activatedAsync(clarityTransactionDispatcher) {\n\n    }\n\n    approveComponentRemovalAsync(component) { }\n\n    approveEntityRemovalAsync(entity) { }\n\n    deactivatedAsync(clarityTransactionDispatcher) { }\n\n    disposeAsync(clarityTransactionDispatcher) { }\n\n    entityAddedAsync(entity) { }\n\n    entityUpdatedAsync(oldEntity, newEntity) { }\n\n    entityRemovedAsync(entity) { }\n\n    entityRetrievedAsync(entity) { }\n\n    entityContentUpdatedAsync(oldContentId, newContentId) { }\n\n    entityComponentAddedAsync(entity, component) { }\n\n    entityComponentUpdatedAsync(entity, oldComponent, newComponent) { }\n\n    entityComponentRemovedAsync(entity, component) { }\n\n    entityComponentRetrievedAsync(entity, component) { }\n\n    getName() { }\n\n    getGuid() { }\n\n    initializeAsync(clarityTransactionDispatcher) {\n        this._clarityTransactionDispatcher = clarityTransactionDispatcher;\n    }\n\n    serviceRemovedAsync(name, service) { }\n\n    validateEntityAsync(entity) { }\n\n    validateComponentAsync(component) { }\n\n    validateEntityContentAsync(entity, oldContentId, newContentId) { }\n\n}"]}